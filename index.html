<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OKIENAK V6.0 - Secure Paste</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style id="custom-styles">
        /* Variabel Warna Dasar (Deep Purple - Default) */
        :root {
            --p: #673AB7; /* Primary / Deep Purple */
            --l: #EDE7F6; /* Light Purple/Lavender - Default Background */
            --b: #FFFFFF; /* Background Putih Bersih (Card) */
            --t: #4527A0; /* Text Darker Purple */
            --e: #E53935; /* Error Red */
            --s: #4CAF50; /* Success Green */
            --sh: rgba(103, 58, 183, 0.25); /* Subtle Shadow dari Primary */
            
            /* Custom Font Defaults */
            --c-ff: 'Inter', sans-serif; 
            --c-fs: 1.0rem;
            --c-fw: 400; 
            --c-fc: var(--t);
            
            /* Toast Colors */
            --toast-success: #4CAF50;
            --toast-error: #E53935;
            --toast-info: #2196F3;
        }

        /* 1. ANIMATED BACKGROUND (Smooth) */
        .bg-animated {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: linear-gradient(-45deg, var(--l), #D1C4E9, #EDE7F6, #CFD8DC);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite; /* Animasi 15 detik */
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* 2. UI GLOBAL REFINEMENT */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: var(--c-ff); transition: all 0.3s cubic-bezier(0.25, 0.8, 0.5, 1); }
        html, body { min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 0; color: var(--t); }
        
        .main-container { width: 90%; max-width: 700px; background: var(--b); border-radius: 20px; padding: 50px; 
            box-shadow: 0 25px 50px rgba(0,0,0,0.15); margin: 40px auto; 
            display: flex; flex-direction: column; align-items: center; border-top: 5px solid var(--p);
            animation: cardLoad 0.5s ease-out; position: relative; z-index: 10;
        }
        @keyframes cardLoad { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Icon & Input Group Styling */
        .input-group { position: relative; margin-bottom: 1.8rem; width: 100%; }
        .input-group i { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--p); font-size: 1.1rem; pointer-events: none; }
        .input-group input, .input-group textarea { padding-left: 50px !important; margin-bottom: 0 !important; }
        .password-toggle { position: absolute; top: 50%; right: 15px; transform: translateY(-50%); cursor: pointer; font-size: 0.8rem; z-index: 10; color: var(--p); font-weight: 600; text-transform: uppercase; background: #F8F9FA; padding: 5px 10px; border-radius: 50px; }
        
        /* Button & Link Style */
        .pill-button { background: var(--p); color: #fff; cursor: pointer; border: none; font-weight: 600; border-radius: 50px; 
            padding: 1rem 2.2rem; box-shadow: 0 8px 15px var(--sh); letter-spacing: 0.5px; text-transform: uppercase; display: flex; align-items: center; justify-content: center; gap: 8px;}
        .icon-btn { background: var(--b); color: var(--p); border: 2px solid var(--p); padding: 10px 18px; border-radius: 50px; cursor: pointer; font-size: 0.9rem; line-height: 1; font-weight: 600; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .icon-btn:hover { background: var(--p); color: #fff; }
        
        /* Note Card Rapi */
        .note-card { background: #F9F9F9; border: 1px solid #EAECEE; border-left: 5px solid var(--p); border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        .na { display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px; }
        .na .pill-button { padding: 8px 15px; font-size: 0.8rem; border-radius: 50px; box-shadow: none; text-transform: none; }
        .btn-edit { background: #3F51B5 !important; }
        .btn-delete { background: var(--e) !important; }

        /* Utility */
        .hidden { display: none !important; }
        footer { margin-top: auto; padding: 25px 20px 25px; text-align: center; color: #9575CD; font-size: .85rem; width: 100%; font-weight: 500; }
        
        /* Toast Styles (retained but slightly refined) */
        #tc { position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
        .toast { min-width: 250px; padding: 15px 20px; border-radius: 10px; color: #fff; opacity: 0; transform: translateX(100%); transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15); font-weight: 500; display: flex; align-items: center; }
        .toast.show { opacity: 1; transform: translateX(0); }
        .toast.success { background: var(--toast-success); }
        .toast.error { background: var(--toast-error); }
        .toast.info { background: var(--toast-info); }
        .toast i { margin-right: 10px; font-size: 1.1rem; }
    </style>
</head>
<body>
    <div class="bg-animated"></div> <div class="main-container hidden" id="hC">
        <h1 style="font-size: 3rem; color: var(--p); margin-bottom: 15px; letter-spacing: 1px;">OKIENAK</h1>
        <p style="font-size: 1.1rem; color: #777; margin-bottom: 40px; font-weight: 300;">Secure, private content sharing platform.</p>
        <button id="jB" class="pill-button" style="padding: 15px 45px; font-size: 1.1rem;"><i class="fas fa-lock-open"></i> ACCESS ACCOUNT</button>
    </div>

    <div class="main-container hidden" id="aC">
        <h1 style="color:var(--t); font-size: 2rem; margin-bottom: 0;">Secure <span style="color:var(--p);">Access</span></h1>
        <p style="margin-bottom: 2.5rem; font-size: 0.9rem; color: #777; font-weight: 300;">Login or create an account.</p>
        
        <div class="tab" style="max-width:350px;">
            <button id="lT" class="active-tab">Sign In</button>
            <button id="rT">Sign Up</button>
        </div>

        <div id="lF" style="width:100%;">
            <div class="input-group"><i class="fas fa-envelope"></i><input id="lE" type="email" placeholder="Email Address"></div>
            <div class="input-group"><i class="fas fa-key"></i><input id="lP" type="password" placeholder="Password"><span class="password-toggle" id="lPTog">SHOW</span></div>
            <button id="lB" class="pill-button" style="width:100%;"><i class="fas fa-sign-in-alt"></i> LOGIN</button>
        </div>

        <div id="rF" class="hidden" style="width:100%;">
            <div class="input-group"><i class="fas fa-envelope-open-text"></i><input id="rE" type="email" placeholder="Email Address"></div>
            <div class="input-group"><i class="fas fa-lock"></i><input id="rP" type="password" placeholder="Password (Min. 3 chars)"><span class="password-toggle" id="rPTog">SHOW</span></div>
            <div class="input-group"><i class="fas fa-check-double"></i><input id="rCP" type="password" placeholder="Confirm Password"><span class="password-toggle" id="rCPTog">SHOW</span></div>
            <button id="rB" class="pill-button" style="width:100%;"><i class="fas fa-user-plus"></i> REGISTER</button>
        </div>
    </div>

    <div class="main-container hidden" id="nC">
        <div style="width:100%; display:flex; justify-content:space-between; align-items:center; margin-bottom:2.5rem;">
             <h1 style="font-size:1.8rem; color:var(--t);"><i class="fas fa-clipboard-check"></i> <span style="color:var(--p);" id="uN"></span>'s Vault</h1>
             <div style="display:flex; gap:12px;">
                 <button id="sTog" class="icon-btn" title="Settings"><i class="fas fa-cogs"></i></button>
                 <button id="lB2" class="icon-btn" style="background:var(--e); color:#fff;" title="Logout"><i class="fas fa-sign-out-alt"></i></button>
             </div>
        </div>
        
        <div id="adminView" class="hidden" style="width:100%; margin-bottom: 2rem;">
            <div class="toggle-section" id="adminToggle">
                <h4><i class="fas fa-shield-alt"></i> ADMIN CONTROL PANEL <span id="adminToggleIcon" class="toggle-icon">+</span></h4>
                <div id="adminContent" class="toggle-content hidden">
                    <h5 style="color:var(--e); margin-bottom: 10px;">ALL SERVER NOTES (Total: <span id="totalNotesCount">0</span>)</h5>
                    <div id="allNotesList"></div>
                </div>
            </div>
        </div>
        
        <div id="settingsSection" class="hidden" style="width:100%;">
             <div class="toggle-section" id="styleToggle">
                <h4><i class="fas fa-palette"></i> VISUAL SETTINGS <span id="styleToggleIcon" class="toggle-icon">+</span></h4>
                <div id="styleContent" class="toggle-content hidden">
                    <h5 style="color:var(--p); margin-bottom:1.5rem; text-align:center; font-weight: 500;">Customize Your Display Style</h5>
                    <div class="form-row">
                        <div style="flex:1; min-width:200px;">
                            <label style="font-weight:500; font-size: 0.9rem;">Theme Color (Primary):</label>
                            <input type="color" id="cC" value="#673AB7" style="width:100%; height:40px; padding:5px; margin:0; border-radius: 5px;">
                        </div>
                        <div style="flex:1; min-width:200px;">
                            <label style="font-weight:500; font-size: 0.9rem;">Font Color (Text):</label>
                            <input type="color" id="cSC" value="#4527A0" style="width:100%; height:40px; padding:5px; margin:0; border-radius: 5px;">
                        </div>
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="font-weight:500; font-size: 0.9rem;">Font Family:</label>
                        <select id="cF" style="margin-bottom:0;">
                            <option value="Inter, sans-serif">Inter (Sleek)</option>
                            <option value="Montserrat, sans-serif">Montserrat (Modern)</option>
                            <option value="Roboto, sans-serif">Roboto (Standard)</option>
                            <option value="monospace">Monospace (Code)</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div style="flex:1;">
                            <label style="font-weight:500; font-size: 0.9rem;">Size (px):</label>
                            <input type="number" id="cSZ" value="16" min="10" max="30" style="margin:0;">
                        </div>
                        <div style="flex:1;">
                            <label style="font-weight:500; font-size: 0.9rem;">Weight:</label>
                            <select id="cSW" style="margin:0;">
                                <option value="400">Regular</option>
                                <option value="500">Medium</option>
                                <option value="600">Semi-Bold</option>
                                <option value="700">Bold</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="sCSB" class="pill-button" style="width:100%; margin-top:10px; background: #3F51B5;"><i class="fas fa-save"></i> SAVE SETTINGS</button>
            <hr style="border:0; border-top:1px solid #ECEFF1; margin:30px 0;">
        </div>
        
        <div id="newOKIENAKForm" style="width:100%;">
            <h2 id="formTitle" style="font-size:1.5rem; margin-bottom:2rem; color:var(--p); border-bottom:1px solid #ECEFF1; padding-bottom:10px;"><i class="fas fa-pen-nib"></i> Create New OKIENAK</h2>
            
            <div class="input-group"><i class="fas fa-heading"></i><input id="pT" type="text" placeholder="Optional OKIENAK Title (e.g., Project Credentials)"></div>
            
            <div class="form-row">
                <select id="sH" style="flex:1;">
                    <option value="text">Content Type: Plain Text</option>
                    <option value="code">Content Type: Code/Syntax</option>
                    <option value="link">Content Type: Hyperlink</option>
                </select>
                <select id="eO" style="flex:1;">
                    <option value="never">Expiry: No Limit (âˆž)</option>
                    <option value="1h">Expiry: 1 Hour</option>
                    <option value="1d">Expiry: 1 Day</option>
                    <option value="1w">Expiry: 1 Week</option>
                    <option value="1m">Expiry: 1 Month</option>
                    <option value="1y">Expiry: 1 Year (Max)</option>
                </select>
            </div>
            
            <textarea id="nI" placeholder="Type your secure content here..." style="min-height: 180px;"></textarea>
            
            <div class="input-group"><i class="fas fa-lock"></i><input id="nPI" type="password" placeholder="Optional Password Protection" style="padding-right: 6rem; margin-bottom:0;"><span class="password-toggle" id="nPITog">SHOW</span></div>
        </div>
        
        <button id="aNB" class="pill-button" style="width:100%; margin-top:30px;"><i class="fas fa-cloud-upload-alt"></i> PUBLISH OKIENAK</button>
        <button id="sE" class="pill-button btn-save-edit hidden" style="width:100%; margin-top:30px;"><i class="fas fa-save"></i> SAVE CHANGES</button>
        <button id="cB" class="pill-button hidden" style="width:100%; margin-top:15px; background: #9E9E9E;"><i class="fas fa-times"></i> CANCEL EDIT</button>

        <div id="nL" style="margin-top:4rem; width:100%;">
            <h2 style="font-size:1.5rem; margin-bottom:2rem; color:var(--t); border-bottom:1px solid #ECEFF1; padding-bottom:10px;"><i class="fas fa-list-alt"></i> My OKIENAKs</h2>
        </div>
    </div>

    <div id="tc"></div>

    <footer>
        &copy; 2026 OKIENAK | Owner: <a href="mailto:cidmomo19@gmail.com">cidmomo19@gmail.com</a>
    </footer>

    <script>
        // Mapping DOM Elements
        const D = {
            hC: document.getElementById("hC"), aC: document.getElementById("aC"), nC: document.getElementById("nC"), jB: document.getElementById("jB"), tC: document.getElementById("tc"), sTog: document.getElementById("sTog"), lB2: document.getElementById("lB2"), settingsSection: document.getElementById("settingsSection"), 
            lT: document.getElementById("lT"), rT: document.getElementById("rT"), lE: document.getElementById("lE"), lP: document.getElementById("lP"), lPTog: document.getElementById("lPTog"), lB: document.getElementById("lB"), rE: document.getElementById("rE"), rP: document.getElementById("rP"), rPTog: document.getElementById("rPTog"), rCP: document.getElementById("rCP"), rCPTog: document.getElementById("rCPTog"), rB: document.getElementById("rB"), lF: document.getElementById("lF"), rF: document.getElementById("rF"),
            uN: document.getElementById("uN"), pT: document.getElementById("pT"), sH: document.getElementById("sH"), eO: document.getElementById("eO"), nI: document.getElementById("nI"), nPI: document.getElementById("nPI"), nPITog: document.getElementById("nPITog"), aNB: document.getElementById("aNB"), sE: document.getElementById("sE"), cB: document.getElementById("cB"), formTitle: document.getElementById("formTitle"), nL: document.getElementById("nL"),
            cC: document.getElementById("cC"), cF: document.getElementById("cF"), cSZ: document.getElementById("cSZ"), cSW: document.getElementById("cSW"), cSC: document.getElementById("cSC"), 
            adminView: document.getElementById("adminView"), adminToggle: document.getElementById("adminToggle"), adminContent: document.getElementById("adminContent"), adminToggleIcon: document.getElementById("adminToggleIcon"), allNotesList: document.getElementById("allNotesList"), totalNotesCount: document.getElementById("totalNotesCount"),
        };

        let currentEditIndex = null; 
        const oE = "cidmomo19@gmail.com"; 

        // --- GLOBAL UTILITIES ---
        const gU = () => JSON.parse(localStorage.getItem("users") || "{}");
        const sU = u => localStorage.setItem("users", JSON.stringify(u));
        const gLUE = () => localStorage.getItem("loggedIn");

        const lk = t => {
            const p = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
            return t.replace(p, '<a href="$1" target="_blank" style="color:var(--p); font-weight:600;">$1</a>');
        }
        
        // Expiry Calculator (Waktu dalam ms)
        const gE = (o) => {
            const units = { 'h': 3600000, 'd': 86400000, 'w': 604800000, 'm': 2629746000, 'y': 31556952000 };
            if (o === 'never') return null;
            const unit = o.slice(-1);
            const value = parseInt(o.slice(0, -1));
            return Date.now() + value * (units[unit] || 0);
        };
        
        const gRE = (expiryTime) => {
            if (!expiryTime) return 'never';
            const diff = expiryTime - Date.now();
            const hour = 3600000;
            if (diff <= 0) return 'expired';

            if (diff < hour * 1.5) return '1h';
            if (diff < hour * 24 * 1.5) return '1d';
            if (diff < hour * 24 * 7 * 1.5) return '1w';
            if (diff < hour * 24 * 30 * 1.5) return '1m';
            return '1y'; 
        };
        
        // Toast Notification Function
        function sT(m, t = 'info') {
            const o = document.createElement('div');
            const iconMap = { success: 'fa-check-circle', error: 'fa-exclamation-triangle', info: 'fa-info-circle' };
            o.className = `toast ${t}`;
            o.innerHTML = `<i class="fas ${iconMap[t]}"></i> ${m}`;
            
            const existingToasts = D.tC.querySelectorAll('.toast');
            if (existingToasts.length >= 3) existingToasts[0].remove();

            D.tC.appendChild(o);
            setTimeout(() => o.classList.add('show'), 10);
            setTimeout(() => {
                o.classList.remove('show');
                o.addEventListener('transitionend', () => o.remove(), { once: true });
            }, 4000);
        }
        
        function tPV(input, toggle) {
            const isP = input.type === 'password';
            input.type = isP ? 'text' : 'password';
            toggle.textContent = isP ? 'HIDE' : 'SHOW'; 
        }

        // Apply Custom Theme Color
        function aCTC(color) {
            const root = document.documentElement;
            const hexToRgb = (hex) => {
                const bigint = parseInt(hex.slice(1), 16);
                const r = (bigint >> 16) & 255;
                const g = (bigint >> 8) & 255;
                const b = bigint & 255;
                return [r, g, b];
            };
            const [r, g, b] = hexToRgb(color);
            const lr = Math.round(255 * 0.9 + r * 0.1);
            const lg = Math.round(255 * 0.9 + g * 0.1);
            const lb = Math.round(255 * 0.9 + b * 0.1);
            const lightColor = `rgb(${lr}, ${lg}, ${lb})`;
            
            root.style.setProperty('--p', color);
            root.style.setProperty('--l', lightColor);
        }

        // --- PAGE NAVIGATION & AUTH LOGIC ---
        function sHP() { D.nC.classList.add("hidden"); D.aC.classList.add("hidden"); D.hC.classList.remove("hidden"); }
        function sAP() { D.hC.classList.add("hidden"); D.aC.classList.remove("hidden"); D.lF.classList.remove("hidden"); D.rF.classList.add("hidden"); D.lT.classList.add("active-tab"); D.rT.classList.remove("active-tab"); }
        
        function sNP(e) {
            D.hC.classList.add("hidden"); D.aC.classList.add("hidden"); D.nC.classList.remove("hidden");
            D.uN.textContent = e.split('@')[0];
            
            if (e === oE) { D.adminView.classList.remove("hidden"); rAN(); } else { D.adminView.classList.add("hidden"); }
            
            D.settingsSection.classList.add("hidden");
            lCS(e); rN(); resetFormState(); 
        }
        
        D.jB.addEventListener("click", sAP); 
        D.lT.addEventListener("click", () => { D.lF.classList.remove("hidden"); D.rF.classList.add("hidden"); D.lT.classList.add("active-tab"); D.rT.classList.remove("active-tab"); });
        D.rT.addEventListener("click", () => { D.rF.classList.remove("hidden"); D.lF.classList.add("hidden"); D.rT.classList.add("active-tab"); D.lT.classList.remove("active-tab"); });
        
        // Password Toggles Setup
        D.lPTog.addEventListener('click', () => tPV(D.lP, D.lPTog));
        D.rPTog.addEventListener('click', () => tPV(D.rP, D.rPTog));
        D.rCPTog.addEventListener('click', () => tPV(D.rCP, D.rCPTog));
        D.nPITog.addEventListener('click', () => tPV(D.nPI, D.nPITog));

        // Auth Logic (Register, Login, Logout) - (Kode dipertahankan)
        D.rB.addEventListener("click", () => {
            const e = D.rE.value.trim(); const p = D.rP.value.trim(); const cP = D.rCP.value.trim();
            if (!e || !p || !cP) return sT("Please fill in all fields!", 'error');
            if (p.length < 3 || p !== cP) return sT("Password min 3 chars and must match!", 'error');
            let u = gU();
            if (u[e]) return sT("Email already registered!", 'error');
            u[e] = { password: p, pastes: [], style: { color: D.cC.value, fontFamily: D.cF.value, fontSize: D.cSZ.value, fontWeight: D.cSW.value, fontColor: D.cSC.value }, visits: 0 };
            sU(u);
            sT("Registration successful! Please login.", 'success');
            D.rE.value = D.rP.value = D.rCP.value = "";
            D.lT.click();
        });

        D.lB.addEventListener("click", () => {
            const e = D.lE.value.trim(); const p = D.lP.value.trim(); let u = gU();
            if (u[e] && u[e].password === p) {
                localStorage.setItem("loggedIn", e);
                sT(`Welcome back, ${e.split('@')[0]}!`, 'success');
                sNP(e); 
            } else { sT("Incorrect email or password!", 'error'); }
        });

        D.lB2.addEventListener("click", () => { 
            if (confirm("Are you sure you want to log out?")) { localStorage.removeItem("loggedIn"); location.reload(); }
        });
        
        // Settings/Admin Toggle Logic
        D.sTog.addEventListener("click", () => D.settingsSection.classList.toggle("hidden"));
        const toggleContent = (content, icon) => { const isHidden = content.classList.toggle('hidden'); icon.textContent = isHidden ? 'collapse' : 'expand'; };
        D.styleToggle.addEventListener('click', (e) => { if(e.target.tagName !== 'INPUT' && e.target.tagName !== 'SELECT' && e.target.tagName !== 'BUTTON') toggleContent(D.styleContent, D.styleToggleIcon); });
        D.adminToggle.addEventListener('click', (e) => { if(e.target.tagName !== 'BUTTON' && e.target.tagName !== 'A') toggleContent(D.adminContent, D.adminToggleIcon); if (!D.adminContent.classList.contains("hidden")) rAN(); });
        
        // Custom Style Logic
        function lCS(email) {
            const u = gU(); const style = u[email]?.style; 
            if (style) {
                aCTC(style.color);
                document.documentElement.style.setProperty('--c-ff', style.fontFamily);
                document.documentElement.style.setProperty('--c-fs', `${style.fontSize}px`);
                document.documentElement.style.setProperty('--c-fw', style.fontWeight);
                document.documentElement.style.setProperty('--c-fc', style.fontColor);
                D.cC.value = style.color; D.cF.value = style.fontFamily; D.cSZ.value = style.fontSize; D.cSW.value = style.fontWeight; D.cSC.value = style.fontColor;
            }
        }
        D.sCSB.addEventListener('click', () => {
            const e = gLUE(); if (!e) return; let u = gU();
            u[e].style = { color: D.cC.value, fontFamily: D.cF.value, fontSize: D.cSZ.value, fontWeight: D.cSW.value, fontColor: D.cSC.value };
            sU(u); lCS(e); rN(); sT("Settings saved successfully!", 'success');
        });
        
        // --- FORM STATE & CRUD ---
        function resetFormState() {
            currentEditIndex = null;
            D.formTitle.innerHTML = '<i class="fas fa-pen-nib"></i> Create New OKIENAK';
            D.aNB.classList.remove("hidden"); D.sE.classList.add("hidden"); D.cB.classList.add("hidden");
            D.nI.value = D.pT.value = D.nPI.value = ""; D.sH.value = "text"; D.eO.value = "never"; D.nPI.type = "password"; D.nPITog.textContent = "SHOW";
        }
        D.cB.addEventListener('click', resetFormState);

        D.aNB.addEventListener("click", () => {
            const e = gLUE(); let u = gU();
            const newNote = {
                title: D.pT.value || "Untitled Note",
                content: D.nI.value,
                syntax: D.sH.value,
                expiry: gE(D.eO.value),
                password: D.nPI.value.trim() || null,
                visits: 0
            };
            if (!newNote.content) return sT("Content cannot be empty!", 'error');
            
            u[e].pastes.unshift(newNote);
            sU(u);
            sT("OKIENAK Published Successfully!", 'success');
            resetFormState();
            rN();
        });

        window.uN = (i) => {
            const e = gLUE(); let u = gU(); const nO = u[e].pastes[i];
            currentEditIndex = i;
            D.formTitle.innerHTML = `<i class="fas fa-edit"></i> Editing: <span style="color:var(--p);">${nO.title}</span>`;
            D.pT.value = nO.title; D.sH.value = nO.syntax; D.nI.value = nO.content;
            D.eO.value = gRE(nO.expiry);
            D.nPI.value = ""; // Always reset password input on edit
            D.aNB.classList.add("hidden"); D.sE.classList.remove("hidden"); D.cB.classList.remove("hidden");
        };
        
        D.sE.addEventListener("click", () => {
            if (currentEditIndex === null) return;
            const e = gLUE(); let u = gU();
            
            u[e].pastes[currentEditIndex].title = D.pT.value || "Untitled Note";
            u[e].pastes[currentEditIndex].content = D.nI.value;
            u[e].pastes[currentEditIndex].syntax = D.sH.value;
            if(D.nPI.value.trim()) { // Update password hanya jika diisi
                u[e].pastes[currentEditIndex].password = D.nPI.value.trim();
            } else if (u[e].pastes[currentEditIndex].password !== null && D.nPI.type === 'text') {
                // Jika password sebelumnya ada, tapi user mengosongkan field dan set type=text (show), anggap di-delete
                u[e].pastes[currentEditIndex].password = null;
            }
            // Expiry tidak diupdate untuk menyederhanakan, hanya saat CREATE
            
            sU(u); sT("Note changes saved!", 'success'); resetFormState(); rN();
        });

        window.dN = (i) => {
            if (!confirm("Are you sure you want to delete this OKIENAK?")) return;
            const e = gLUE(); let u = gU(); u[e].pastes.splice(i, 1);
            sU(u); sT("OKIENAK deleted.", 'error'); rN();
        };

        // --- RENDER NOTES (User & Admin) ---

        function formatContent(content, syntax) {
            if (syntax === 'link') return lk(content);
            if (syntax === 'code') return `<div class="code-block">${content.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</div>`;
            return content.replace(/\n/g, '<br>');
        }
        
        function rN() {
            const e = gLUE(); let u = gU(); D.nL.innerHTML = '<h2 style="font-size:1.5rem; margin-bottom:2rem; color:var(--t); border-bottom:1px solid #ECEFF1; padding-bottom:10px;"><i class="fas fa-list-alt"></i> My OKIENAKs</h2>';
            if (!u[e] || u[e].pastes.length === 0) {
                 D.nL.innerHTML += `<p style="text-align: center; color: #999; font-style: italic; margin-top: 30px;">You haven't published any OKIENAKs yet.</p>`;
                 return;
            }

            u[e].pastes.forEach((nO, i) => {
                const isExpired = nO.expiry && nO.expiry <= Date.now();
                const isProtected = nO.password;
                const statusText = isExpired ? 'EXPIRED' : (isProtected ? 'PROTECTED' : 'OPEN');
                const statusColor = isExpired ? varCSS('--e') : (isProtected ? '#F39C12' : varCSS('--s'));
                
                const card = document.createElement("div"); card.className = "note-card";
                card.style.borderLeftColor = statusColor;
                
                const displayContent = isProtected && !isExpired ? 
                    `<p style="color:var(--t); margin-top:10px;"><i class="fas fa-lock" style="color:#F39C12;"></i> This content is password protected.</p>` :
                    formatContent(nO.content, nO.syntax);

                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div>
                            <strong style="color:var(--t);font-size:1.1rem; font-weight: 700;">${nO.title}</strong>
                            <p style="font-size: 0.8rem; color: #777; margin-top: 5px;">Type: ${nO.syntax} | <span style="font-weight: 600; color: ${statusColor};">${statusText}</span></p>
                        </div>
                        <span style="font-size: 0.85rem; color: #999;">Visits: ${nO.visits || 0}</span>
                    </div>
                    <p style="font-size: 0.85rem; color: #777; margin-top: 10px;">Expires: ${nO.expiry ? new Date(nO.expiry).toLocaleString() : 'Never'}</p>
                    <div style="margin-top: 15px;">${displayContent}</div>

                    <div class="na">
                        <button class="pill-button btn-edit" onclick="uN(${i})"><i class="fas fa-edit"></i> Edit</button>
                        <button class="pill-button btn-delete" onclick="dN(${i})"><i class="fas fa-trash-alt"></i> Delete</button>
                    </div>
                `;
                D.nL.appendChild(card);
            });
        }
        
        // --- FITUR ADMIN BYPASS PASSWORD (KRITIS) ---
        function varCSS(name) { return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

        window.viewNoteContent = (userEmail, noteIndex) => {
            const loggedInEmail = gLUE();
            if (loggedInEmail !== oE) return sT("Access Denied: Only the Owner can use this feature.", 'error');

            let u = gU();
            const targetUser = u[userEmail];
            if (!targetUser) return sT(`User ${userEmail} not found.`, 'error');
            
            const nO = targetUser.pastes[noteIndex];
            if (!nO) return sT("Note not found.", 'error');

            const contentHTML = formatContent(nO.content, nO.syntax);
            
            // Tampilkan konten dalam modal/alert (sederhana)
            const popup = window.open('', 'NoteContent', 'width=600,height=400,scrollbars=yes');
            popup.document.write(`
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <title>${userEmail}'s Note: ${nO.title}</title>
                    <style>
                        body { font-family: ${varCSS('--c-ff')}; padding: 20px; background: #f4f4f4; color: #333; }
                        .content-box { background: white; padding: 20px; border-radius: 8px; border-left: 5px solid ${varCSS('--e')}; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
                        h2 { color: ${varCSS('--p')}; margin-bottom: 15px; }
                        .code-block { background: #2D3E50; color: #ECF0F1; padding: 15px; border-radius: 6px; overflow-x: auto; font-family: 'monospace'; white-space: pre-wrap; word-wrap: break-word; font-size: 0.9rem; }
                    </style>
                </head>
                <body>
                    <div class="content-box">
                        <h2>Owner Bypass View: ${nO.title}</h2>
                        <p><strong>Owner:</strong> ${userEmail}</p>
                        <p><strong>Status:</strong> Unlocked by Admin (Password: ${nO.password || 'None'})</p>
                        <hr>
                        ${contentHTML}
                    </div>
                </body>
                </html>
            `);
            popup.document.close();
            sT("Owner Bypass Activated: Content viewed in a new window.", 'info');
        };

        function rAN() {
            let u = gU();
            D.allNotesList.innerHTML = '';
            let totalCount = 0;

            for (const email in u) {
                u[email].pastes.forEach((nO, i) => {
                    const isProtected = nO.password;
                    const statusText = isProtected ? 'PROTECTED' : 'OPEN';
                    const statusColor = isProtected ? '#F39C12' : varCSS('--s');
                    totalCount++;
                    
                    const div = document.createElement("div");
                    div.className = "note-card";
                    div.style.borderLeftColor = statusColor;
                    div.style.background = '#F0F0F0';

                    div.innerHTML = `
                        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                            <div>
                                <strong style="color:var(--t);font-size:1rem;">${nO.title}</strong>
                                <p style="font-size: 0.8rem; color: #777; margin-top: 5px;">User: ${email} | <span style="font-weight: 600; color: ${statusColor};">${statusText}</span></p>
                            </div>
                        </div>
                        <div class="na" style="justify-content: flex-start; margin-top: 10px;">
                            <button class="pill-button" style="background:var(--e); color:white; padding: 6px 12px; font-size: 0.8rem;" 
                                onclick="viewNoteContent('${email}', ${i})"><i class="fas fa-eye"></i> BYPASS VIEW</button>
                        </div>
                    `;
                    D.allNotesList.appendChild(div);
                });
            }
            D.totalNotesCount.textContent = totalCount;
            if (totalCount === 0) { D.allNotesList.innerHTML = `<p style="color:#999; text-align:center;">No notes found on server.</p>`; }
        }

        // --- INITIALIZATION ---
        window.addEventListener("load", () => {
            try {
                let u = gU();
                // Ensure owner account exists
                if (!u[oE]) {
                     u[oE] = { password: "ipulapik999#", pastes: [], style: { color: "#673AB7", fontFamily: "Inter, sans-serif", fontSize: "16", fontWeight: "400", fontColor: "#4527A0" }, visits: 0 };
                    sU(u);
                }

                const l = gLUE();
                if (l) { sNP(l); } else { sHP(); }
                
                // Set default style in UI
                lCS(l || oE);

            } catch (error) {
                console.error("Initialization Error:", error);
                sT("Critical Error: Cannot load website. Please clear browser storage.", 'error');
                sHP(); 
            }
        });
        
    </script>
</body>
</html>
